// KORE Standard Library - Filesystem Module
// Provides path manipulation and filesystem utilities
//
// Essential for the self-hosted compiler to handle file paths.

// =============================================================================
// Path Manipulation
// =============================================================================

/// A path represents a filesystem path with utilities for manipulation.
struct Path:
    raw: String

impl Path:
    /// Create a new Path from a string.
    pub fn new(s: String) -> Path:
        return Path { raw: s }
    
    /// Get the raw string representation.
    pub fn to_string(self) -> String:
        return self.raw
    
    /// Get the file extension (without the dot).
    /// Returns empty string if no extension.
    ///
    /// Example:
    ///     Path::new("main.kr").extension()  // "kr"
    ///     Path::new("README").extension()   // ""
    ///
    pub fn extension(self) -> String:
        let parts = split(self.raw, ".")
        if len(parts) > 1:
            return parts[len(parts) - 1]
        return ""
    
    /// Get the filename without the directory.
    ///
    /// Example:
    ///     Path::new("src/main.kr").filename()  // "main.kr"
    ///
    pub fn filename(self) -> String:
        // Handle both Unix and Windows separators
        let parts = split(self.raw, "/")
        if len(parts) > 0:
            let last = parts[len(parts) - 1]
            // Also check for Windows backslash
            let win_parts = split(last, "\\")
            if len(win_parts) > 0:
                return win_parts[len(win_parts) - 1]
            return last
        return self.raw
    
    /// Get the filename without extension (the "stem").
    ///
    /// Example:
    ///     Path::new("src/main.kr").stem()  // "main"
    ///
    pub fn stem(self) -> String:
        let name = self.filename()
        let parts = split(name, ".")
        if len(parts) > 1:
            // Join all but last part (handles "file.test.kr")
            let result = parts[0]
            for i in range(1, len(parts) - 1):
                result = result + "." + parts[i]
            return result
        return name
    
    /// Get the parent directory.
    ///
    /// Example:
    ///     Path::new("src/main.kr").parent()  // "src"
    ///
    pub fn parent(self) -> String:
        let parts = split(self.raw, "/")
        if len(parts) > 1:
            let result = parts[0]
            for i in range(1, len(parts) - 1):
                result = result + "/" + parts[i]
            return result
        return "."
    
    /// Join this path with another component.
    ///
    /// Example:
    ///     Path::new("src").join("main.kr")  // Path { raw: "src/main.kr" }
    ///
    pub fn join(self, other: String) -> Path:
        if len(self.raw) == 0:
            return Path::new(other)
        if ends_with(self.raw, "/") || ends_with(self.raw, "\\"):
            return Path::new(self.raw + other)
        return Path::new(self.raw + "/" + other)
    
    /// Change the extension.
    ///
    /// Example:
    ///     Path::new("main.kr").with_extension("ll")  // "main.ll"
    ///
    pub fn with_extension(self, ext: String) -> Path:
        let stem = self.stem()
        let parent = self.parent()
        if parent == ".":
            return Path::new(stem + "." + ext)
        return Path::new(parent + "/" + stem + "." + ext)
    
    /// Check if path has the given extension.
    pub fn has_extension(self, ext: String) -> Bool:
        return self.extension() == ext

// =============================================================================
// Filesystem Operations
// =============================================================================

/// Check if a file or directory exists.
pub fn exists(path: String) -> Bool:
    return file_exists(path)

/// Read the entire contents of a file.
pub fn read(path: String) -> String:
    return read_file(path)

/// Write content to a file.
pub fn write(path: String, content: String) -> Unit:
    write_file(path, content)

// =============================================================================
// Directory Utilities (Future: requires native support)
// =============================================================================

// NOTE: These are placeholders. Full directory support requires
// extending kore_runtime.c with opendir/readdir or similar.

/// List files in a directory (placeholder).
/// Currently returns empty array - needs native implementation.
// pub fn list_dir(path: String) -> Array<String>:
//     return []

/// Create a directory (placeholder).
// pub fn mkdir(path: String) -> Bool:
//     return false
